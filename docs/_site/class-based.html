<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <meta name="google-site-verification" content="4SG_2KfCa2XVgO0fu6cjWwpp63M1in1SLQUBAXW0d3I" /> <title>Class-based Settings - Laravel Settings</title> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=G-8FNXG696PB"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-8FNXG696PB', { 'anonymize_ip': true }); </script> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Class-based Settings | Laravel Settings</title> <meta name="generator" content="Jekyll v3.9.0" /> <meta property="og:title" content="Class-based Settings" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Class-Based Settings" /> <meta property="og:description" content="Class-Based Settings" /> <meta property="og:site_name" content="Laravel Settings" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Class-based Settings" /> <script type="application/ld+json"> {"description":"Class-Based Settings","@type":"WebPage","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"/assets/images/logo.png"}},"url":"/class-based","headline":"Class-based Settings","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/index" class="nav-list-link">Introduction</a></li><li class="nav-list-item"><a href="/basic-usage" class="nav-list-link">Basic Usage</a></li><li class="nav-list-item active"><a href="/class-based" class="nav-list-link active">Class-based Settings</a></li><li class="nav-list-item"><a href="/vue" class="nav-list-link">Vue</a></li><li class="nav-list-item"><a href="/settings-ui" class="nav-list-link">Settings UI</a></li><li class="nav-list-item"><a href="/config" class="nav-list-link">Configuration</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/advanced/advanced" class="nav-list-link">Advanced</a><ul class="nav-list "><li class="nav-list-item "><a href="/advanced/setting-types" class="nav-list-link">Setting Types</a></li></ul></li></ul> </nav> <footer class="site-footer"> <p> <button type="button" class="btn btn-sm btn-block btn-purple js-toggle-dark-mode">Come to the dark side</button> </p> <p> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </p> </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Laravel Settings" aria-label="Search Laravel Settings" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="//github.com/ElbowSpaceUK/laravel-settings" class="site-button" > Laravel Settings on GitHub </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <div id="main-content" class="main-content" role="main"> <h1 id="class-based-settings"> <a href="#class-based-settings" class="anchor-heading" aria-labelledby="class-based-settings"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Class-Based Settings </h1> <details open="" class="no_toc"> <summary class="text-delta"> Contents </summary> <ol id="markdown-toc"> <li><a href="#class-based-settings" id="markdown-toc-class-based-settings">Class-Based Settings</a> <ol> <li><a href="#introduction" id="markdown-toc-introduction">Introduction</a></li> <li><a href="#defining-a-class-setting" id="markdown-toc-defining-a-class-setting">Defining a class setting</a></li> <li><a href="#gettingsetting-values" id="markdown-toc-gettingsetting-values">Getting/setting values</a></li> <li><a href="#registering-settings" id="markdown-toc-registering-settings">Registering settings</a></li> <li><a href="#settings-in-depth" id="markdown-toc-settings-in-depth">Settings in depth</a> <ol> <li><a href="#permissions" id="markdown-toc-permissions">Permissions</a></li> <li><a href="#form-field" id="markdown-toc-form-field">Form Field</a></li> <li><a href="#validation" id="markdown-toc-validation">Validation</a></li> <li><a href="#groups" id="markdown-toc-groups">Groups</a></li> <li><a href="#encryption" id="markdown-toc-encryption">Encryption</a></li> <li><a href="#complex-data-types" id="markdown-toc-complex-data-types">Complex data types</a></li> </ol> </li> <li><a href="#migrating-to-class-based-from-anonymous" id="markdown-toc-migrating-to-class-based-from-anonymous">Migrating to class-based from anonymous</a></li> </ol> </li> </ol> </details><hr /> <h2 id="introduction"> <a href="#introduction" class="anchor-heading" aria-labelledby="introduction"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Introduction </h2> <p>The basic settings covered so far are called anonymous settings, and they are a very flexible way of managing settings. As your app starts to grow, you may find you start forgetting which setings you have created.</p> <p>Class-based settings are just a simple class containing information about the setting. This not only lets you benefit from typehinting during development and limits key clashes, but it also gives you a few extra customisations for your settings.</p> <p>Both methods of creating settings are valid, and often youâ€™ll find yourself using a mixture of the two. They are both fundamentally the same, so there are no large feature differences between them.</p> <h2 id="defining-a-class-setting"> <a href="#defining-a-class-setting" class="anchor-heading" aria-labelledby="defining-a-class-setting"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Defining a class setting </h2> <p>We recommend keeping all your settings in an <code class="language-plaintext highlighter-rouge">app/Settings</code> directory. Each setting should be its own class which extends either <code class="language-plaintext highlighter-rouge">Settings\Schema\UserSetting</code> or <code class="language-plaintext highlighter-rouge">Settings\Schema\GlobalSetting</code>. Your IDE should tell you which methods you need to implement.</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kn">use</span> <span class="nc">Settings\Schema\UserSetting</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Settings\Schema\GlobalSetting</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">SiteName</span> <span class="kd">extends</span> <span class="nc">GlobalSetting</span>
<span class="p">{</span>

    <span class="cd">/**
     * The default value of the setting.
     *
     * @return mixed
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">defaultValue</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s1">'My Site Name'</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cd">/**
     * Return the validation rules for the setting.
     *
     * The key to use for the rules is data. You may also override the validator method to customise the validator further
     *
     * @return array
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">rules</span><span class="p">():</span> <span class="kt">array</span><span class="o">|</span><span class="n">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s1">'string|min:2|max:20'</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="cd">/**
     * @return array
     */</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="n">groups</span><span class="p">():</span> <span class="kt">array</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span><span class="s1">'branding'</span><span class="p">,</span> <span class="s1">'appearance'</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <h2 id="gettingsetting-values"> <a href="#gettingsetting-values" class="anchor-heading" aria-labelledby="gettingsetting-values"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Getting/setting values </h2> <p>You can use class-based settings exactly the same as anonymous settings. Instead of a key such as <code class="language-plaintext highlighter-rouge">site_name</code>, you can use the class name instead.</p> <p><code class="language-plaintext highlighter-rouge">\Settings\Setting::getValue(\App\Settings\SiteName::class)</code></p> <p>You can also use the class directly</p> <p><code class="language-plaintext highlighter-rouge">\App\Settings\SiteName::getValue()</code>.</p> <h2 id="registering-settings"> <a href="#registering-settings" class="anchor-heading" aria-labelledby="registering-settings"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Registering settings </h2> <p>Once youâ€™ve created a setting you must register it, so your app knows what settings are available. This is usually done in the <code class="language-plaintext highlighter-rouge">boot</code> function of a service provider using the facade or helper function.</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">public</span> <span class="k">function</span> <span class="n">boot</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="err">\</span><span class="nc">Settings\Setting</span><span class="o">::</span><span class="nf">register</span><span class="p">(</span><span class="k">new</span> <span class="err">\</span><span class="nf">App\Setting\SiteName</span><span class="p">());</span>
        <span class="err">\</span><span class="nc">Settings\Setting</span><span class="o">::</span><span class="nf">register</span><span class="p">([</span>
            <span class="c1">// Create a new class instance manually</span>
            <span class="k">new</span> <span class="err">\</span><span class="nf">App\Setting\SiteName</span><span class="p">(),</span>
            
             <span class="c1">// Letting the service container build the setting means you can inject dependencies into the setting construct.</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">app</span><span class="o">-&gt;</span><span class="nf">make</span><span class="p">(</span><span class="err">\</span><span class="nc">App\Setting\SiteTheme</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
        <span class="p">]);</span>
        
        <span class="err">\</span><span class="nc">Settings\Setting</span><span class="o">::</span><span class="nf">register</span><span class="p">(</span><span class="k">new</span> <span class="err">\</span><span class="nf">App\Setting\SiteName</span><span class="p">(),</span> <span class="p">[</span><span class="s1">'extra'</span><span class="p">,</span> <span class="s1">'groups'</span><span class="p">,</span> <span class="s1">'for'</span><span class="p">,</span> <span class="s1">'the'</span><span class="p">,</span> <span class="s1">'setting'</span><span class="p">]);</span>
    <span class="p">}</span>
</code></pre></div></div> <h2 id="settings-in-depth"> <a href="#settings-in-depth" class="anchor-heading" aria-labelledby="settings-in-depth"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Settings in depth </h2> <h3 id="permissions"> <a href="#permissions" class="anchor-heading" aria-labelledby="permissions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Permissions </h3> <p>You can control who can update and read specific settings. By default anyone can update or read any settings. If you want to limit this for added protection, you can add a <code class="language-plaintext highlighter-rouge">canWrite</code> and <code class="language-plaintext highlighter-rouge">canRead</code> function to class-based settings.</p> <p>These take no arguments and should return a boolean.</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">function</span> <span class="n">canRead</span><span class="p">():</span> <span class="kt">bool</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nc">Auth</span><span class="o">::</span><span class="nf">check</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="nc">Auth</span><span class="o">::</span><span class="nf">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">can</span><span class="p">(</span><span class="s1">'read-this-setting'</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">function</span> <span class="n">canWrite</span><span class="p">():</span> <span class="kt">bool</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nc">Auth</span><span class="o">::</span><span class="nf">check</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="nc">Auth</span><span class="o">::</span><span class="nf">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">can</span><span class="p">(</span><span class="s1">'write-this-setting'</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div> <p>We will take care of ensuring a user has permission before they update a setting.</p> <h3 id="form-field"> <a href="#form-field" class="anchor-heading" aria-labelledby="form-field"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Form Field </h3> <p>Form fields are defined using the <a href="https://tobytwigger.github.io/form-schema-generator/">form schema generator</a>. This allows you to define the form field to update the setting alongside the rest of the setting definition, then automatically create settings pages for your users.</p> <p>You can define any field you need here, including complex fields. The input name for the field is defined in <code class="language-plaintext highlighter-rouge">$this-&gt;key()</code>, and the default value in <code class="language-plaintext highlighter-rouge">$this-&gt;defaultValue()</code>.</p> <p>When using anonymous settings, hardcode the key and value and just pass the result of the field generator directly to <code class="language-plaintext highlighter-rouge">::create</code>.</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1">// app/Settings/Class.php</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">fieldOptions</span><span class="p">():</span> <span class="o">?</span><span class="err">\</span><span class="nc">FormSchema\Schema\Field</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="err">\</span><span class="nc">FormSchema\Generator\Field</span><span class="o">::</span><span class="nf">textInput</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="nb">key</span><span class="p">())</span><span class="o">-&gt;</span><span class="nf">setValue</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">defaultValue</span><span class="p">());</span>
    <span class="p">}</span>
    
    <span class="c1">// ServiceProvider.php</span>
    <span class="err">\</span><span class="nc">Settings\Setting</span><span class="o">::</span><span class="nf">createGlobal</span><span class="p">(</span><span class="mf">...</span><span class="p">,</span> <span class="n">fieldOptions</span><span class="o">:</span> <span class="err">\</span><span class="nc">FormSchema\Generator\Field</span><span class="o">::</span><span class="nf">textInput</span><span class="p">(</span><span class="s1">'mykey'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">setValue</span><span class="p">(</span><span class="s1">'myvalue'</span><span class="p">))</span>

</code></pre></div></div> <p>If you omit this function, or this function returns null, your setting will not show up in automatically generated forms but it can be used everywhere else. This is recommended if you do not plan on using the form scheme generator elsewhere.</p> <h3 id="validation"> <a href="#validation" class="anchor-heading" aria-labelledby="validation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Validation </h3> <p>To ensure the settings entered into the database are valid, you can define an array or string of Laravel rules in the <code class="language-plaintext highlighter-rouge">rules</code> method. If a setting is updated that does not match validation, a validation exception will be thrown and the setting not saved.</p> <p>Thereâ€™s no need to put <code class="language-plaintext highlighter-rouge">required</code>/<code class="language-plaintext highlighter-rouge">optional</code> rules in, but do include <code class="language-plaintext highlighter-rouge">nullable</code> if the option can be null.</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">public</span> <span class="k">function</span> <span class="n">rules</span><span class="p">():</span> <span class="kt">array</span><span class="o">|</span><span class="n">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s1">'string|min:2|max:20'</span><span class="p">;</span>
    <span class="p">}</span>
</code></pre></div></div> <h3 id="groups"> <a href="#groups" class="anchor-heading" aria-labelledby="groups"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Groups </h3> <p>Groups are a way to order settings to the user. By grouping together similar settings (such as those related to the site theme, authentication, emails), it helps users quickly find what theyâ€™re looking for.</p> <p>The <code class="language-plaintext highlighter-rouge">group</code> function should return an array of groups the setting is in. When retrieving a form schema to represent settings, the first group will be taken as the â€˜mainâ€™ group.</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">public</span> <span class="k">function</span> <span class="n">groups</span><span class="p">():</span> <span class="kt">array</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span><span class="s1">'branding'</span><span class="p">,</span> <span class="s1">'appearance'</span><span class="p">];</span>
    <span class="p">}</span>
</code></pre></div></div> <p>To further pad out your settings page, you can add a name and description to any group in your service provider.</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="err">\</span><span class="nc">Settings\Setting</span><span class="o">::</span><span class="nf">registerGroup</span><span class="p">(</span>
        <span class="s1">'branding'</span><span class="p">,</span> <span class="c1">// Group Key</span>
        <span class="s1">'Branding'</span><span class="p">,</span> <span class="c1">// Title for the group</span>
        <span class="s1">'Settings related to the site brand'</span> <span class="c1">// Description for the group</span>
    <span class="p">);</span>
</code></pre></div></div> <h3 id="encryption"> <a href="#encryption" class="anchor-heading" aria-labelledby="encryption"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Encryption </h3> <p>To protect sensitive settings in the database, values can automatically be encrypted and decrypted for you. You can mark a setting as sensitive by adding a <code class="language-plaintext highlighter-rouge">$shouldEncrypt</code> property to the setting class.</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">protected</span> <span class="kt">boolean</span> <span class="nv">$shouldEncrypt</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</code></pre></div></div> <p>Encrypting and decrypting add very little overhead, so you may automatically encrypt all settings unless otherwise specified. To do this, set <code class="language-plaintext highlighter-rouge">encryption</code> to <code class="language-plaintext highlighter-rouge">false</code> in the config file. Anonymous settings use this behaviour to determine whether they should be encrypted.</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// config/laravel-settings.php</span>
<span class="k">return</span> <span class="p">[</span>
    <span class="mf">...</span><span class="p">,</span>
    <span class="s1">'encryption'</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">'default'</span> <span class="o">=&gt;</span> <span class="kc">false</span>
    <span class="p">]</span>
<span class="p">]</span>
</code></pre></div></div> <h3 id="complex-data-types"> <a href="#complex-data-types" class="anchor-heading" aria-labelledby="complex-data-types"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Complex data types </h3> <p>All values in the database are automatically serialised to preserve type. This means that arrays and objects will all be saved and retrieved in the correct format, so you can always retrieve the value of a setting exactly the same as it was when you set it.</p> <p>All primitive types can be serialized already so you donâ€™t need to worry about this. If you want to save a complex object and control how it is saved in the daabase, you can implement the <code class="language-plaintext highlighter-rouge">\Settings\Contract\CastsSettingValue</code> interface on your setting.</p> <p>You will need to define a <code class="language-plaintext highlighter-rouge">castToString</code> and <code class="language-plaintext highlighter-rouge">castToValue</code> functions on the setting which will convert your validated setting value to a database-friendly string and back. This example would handle a complex data object, such as something returned from an API client.</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="cd">/**
    * Turn the API result into a string that can be saved in the database
    */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">castToString</span><span class="p">(</span><span class="err">\</span><span class="nc">My\Api\Result</span> <span class="nv">$value</span><span class="p">)</span><span class="o">:</span> <span class="n">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nb">json_encode</span><span class="p">([</span>
            <span class="s1">'id'</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="o">-&gt;</span><span class="nf">getId</span><span class="p">(),</span>
            <span class="s1">'result'</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="o">-&gt;</span><span class="nf">getResult</span><span class="p">()</span>
        <span class="p">]);</span>
    <span class="p">}</span>

    <span class="cd">/**
    * Turn the string back into an instance of the API result class
    */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">castToValue</span><span class="p">(</span><span class="kt">string</span> <span class="nv">$value</span><span class="p">):</span> <span class="err">\</span><span class="nc">My\Api\Result</span>
    <span class="p">{</span>
        <span class="nv">$value</span> <span class="o">=</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nv">$value</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
        
        <span class="k">return</span> <span class="k">new</span> <span class="err">\</span><span class="nf">My\Api\Result</span><span class="p">(</span><span class="nv">$value</span><span class="p">[</span><span class="s1">'id'</span><span class="p">])</span>
            <span class="o">-&gt;</span><span class="nf">setResult</span><span class="p">(</span><span class="nv">$value</span><span class="p">[</span><span class="s1">'result'</span><span class="p">]);</span>
    <span class="p">}</span>
</code></pre></div></div> <h2 id="migrating-to-class-based-from-anonymous"> <a href="#migrating-to-class-based-from-anonymous" class="anchor-heading" aria-labelledby="migrating-to-class-based-from-anonymous"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Migrating to class-based from anonymous </h2> <p>Often you will start using anonymous settings and move to class-based settings as your application grows. To make this as simple as possible, you can alias a class-based setting and use it as though it was an anonymous setting.</p> <p>To migrate over to class-based settings, you should create each setting as a class-based setting and add an alias, with a key matching the anonymous setting. Then, delete the anonymous setting creation function call in your service provider.</p> <p>You can alias a setting through config or the service provider, or define it directly on your setting class. You only need to use one of the following methods.</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// config/settings.php</span>
<span class="k">return</span> <span class="p">[</span>
    <span class="s1">'aliases'</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">'site_name'</span> <span class="o">=&gt;</span> <span class="err">\</span><span class="nc">App\Setting\SiteName</span><span class="o">::</span><span class="n">class</span><span class="p">,</span>
        <span class="mf">...</span>
    <span class="p">]</span>
<span class="p">];</span>
</code></pre></div></div> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// app/Providers/AppServiceProvider.php</span>
<span class="k">public</span> <span class="k">function</span> <span class="n">boot</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nf">settings</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">alias</span><span class="p">(</span><span class="s1">'site_name'</span><span class="p">,</span> <span class="err">\</span><span class="nc">App\Setting\SiteName</span><span class="o">::</span><span class="n">class</span><span class="p">);</span>
    <span class="err">\</span><span class="nc">Settings\Setting</span><span class="o">::</span><span class="nf">alias</span><span class="p">(</span><span class="s1">'site_name'</span><span class="p">,</span> <span class="err">\</span><span class="nc">App\Setting\SiteName</span><span class="o">::</span><span class="n">class</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// app/Settings/SiteName.php</span>

<span class="k">public</span> <span class="k">function</span> <span class="n">alias</span><span class="p">():</span> <span class="kt">?string</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="s1">'site_name'</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></div></div> <p>You can now use the site name setting as though it had a key <code class="language-plaintext highlighter-rouge">siteName</code>, and so access the setting in the following ways.</p> <p><strong>Same as anonymous</strong></p> <ul> <li><code class="language-plaintext highlighter-rouge">settings('site_name')</code></li> <li><code class="language-plaintext highlighter-rouge">\Settings\Setting::getValue('site_name')</code></li> <li><code class="language-plaintext highlighter-rouge">\Settings\Setting::getSiteName()</code></li> <li><code class="language-plaintext highlighter-rouge">settings()-&gt;getValue('site_name')</code></li> <li><code class="language-plaintext highlighter-rouge">settings()-&gt;getSiteName()</code></li> </ul> <p><strong>Only for class-based</strong></p> <ul> <li><code class="language-plaintext highlighter-rouge">\App\Settings\SiteName::getValue()</code></li> <li><code class="language-plaintext highlighter-rouge">\Settings\Setting::getValue(\App\Settings\SiteName::class)</code></li> </ul> <hr> <footer> <p class="text-small text-grey-dk-100 mb-0"> Copyright &copy; 2020 Toby Twigger. Distributed by an <a href=\"https://github.com/ElbowSpaceUK/laravel-translate/blob/develop/LICENCE.md\">MIT license.</a> </p> <div class="d-flex mt-2"> <p class="text-small text-grey-dk-000 mb-0"> <a href="https://github.com/ElbowSpaceUK/laravel-settings/edit/develop/_docs/class-based.md" id="edit-this-page">Edit this page on GitHub.</a> </p> </div> </footer> </div> </div> <div class="search-overlay"></div> </div> <script> const toggleDarkMode = document.querySelector('.js-toggle-dark-mode'); jtd.addEvent(toggleDarkMode, 'click', function(){ if (jtd.getTheme() === 'dark') { jtd.setTheme('light'); setCookie('theme', 'light', 365); toggleDarkMode.textContent = 'Come to the dark side'; } else { jtd.setTheme('dark'); setCookie('theme', 'dark', 365); toggleDarkMode.textContent = 'Return to the light side'; } }); jtd.onReady(function() { if(getCookie('theme') === 'dark') { jtd.setTheme('dark'); toggleDarkMode.textContent = 'Return to the light side'; } else { jtd.setTheme('light'); toggleDarkMode.textContent = 'Come to the dark side'; } }); function setCookie(cname, cvalue, exdays) { let d = new Date(); d.setTime(d.getTime() + (exdays*24*60*60*1000)); let expires = "expires="+ d.toUTCString(); document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/"; } function getCookie(cname) { let name = cname + "="; let decodedCookie = decodeURIComponent(document.cookie); let ca = decodedCookie.split(';'); for(let i = 0; i <ca.length; i++) { let c = ca[i]; while (c.charAt(0) == ' ') { c = c.substring(1); } if (c.indexOf(name) == 0) { return c.substring(name.length, c.length); } } return ""; } </script> </body> </html>
